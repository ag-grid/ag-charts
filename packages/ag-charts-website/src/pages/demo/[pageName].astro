---
import { getEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { Icon } from '../../components/icon/Icon';
import { getDemoExampleUrl, getDemoPageHashUrl } from '../../utils/pages';

export async function getStaticPaths() {
    const demosData = await getEntry('demo', 'demos');

    const demos = demosData.data.chartTypes
        .map((chartType) => {
            const demosWithChartTypeMeta = chartType.demos.map((demo) => {
                return {
                    ...demo,
                    chartType: chartType.name,
                    slug: chartType.slug,
                    docsUrl: getDemoPageHashUrl(chartType.slug),
                    icon: chartType.icon,
                    enterprise: chartType.enterprise,
                };
            });

            return demosWithChartTypeMeta;
        })
        .flat();

    const pages = demos.map((demo, i) => {
        return {
            params: {
                pageName: demo.example,
            },
            props: {
                page: demo,
                prevDemo: i > 0 ? demos[i - 1] : demos[demos.length - 1],
                nextDemo: demos.length > i + 1 ? demos[i + 1] : demos[0],
            },
        };
    });

    return pages;
}

const { page, prevDemo, nextDemo } = Astro.props;
---

<Layout>
    <div class="page-margin font-size-responsive font-size-medium">
        <h1>
            <span>
                {page.name}
                {
                    page.enterprise && (
                        <span class="enterpriseIcon">
                            <Icon client:only name="enterprise" />
                        </span>
                    )
                }
            </span>

            <a class="font-size-medium" href={page.docsUrl}>
                View {page.chartType.toLowerCase()} charts documentation
            </a>
        </h1>

        <div class="chartExample"></div>

        <p set:html={page.description} />

        <div class="moreDemos">
            <a class="prevDemo" href={getDemoExampleUrl(prevDemo.example)}>
                <div class="dummyImage"></div>
                <span>Previous:</span>
                <b>{prevDemo.name}</b>
            </a>

            <a class="nextDemo" href={getDemoExampleUrl(nextDemo.example)}>
                <div class="dummyImage"></div>
                <span>Next:</span>
                <b>{nextDemo.name}</b>
            </a>
        </div>
    </div>
</Layout>

<style lang="scss">
    @use '../../design-system' as *;

    .page-margin {
        padding-top: $size-5;
        padding-bottom: $size-9;
    }

    h1 {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
    }

    .enterpriseIcon {
        --text-color: red;
        --icon-size: 28px;
    }

    .chartExample {
        width: 100%;
        aspect-ratio: 21 / 9;
        margin-bottom: $size-2;
        border-radius: var(--border-radius);
        background-color: #ddd;
    }

    .moreDemos {
        display: flex;
        gap: $size-2;
        justify-content: space-between;
        margin-top: $size-9;
    }

    .prevDemo,
    .nextDemo {
        width: min(28rem, 50%);
    }

    .dummyImage {
        width: 100%;
        aspect-ratio: 16 / 10;
        background-color: #ddd;
        border-radius: var(--border-radius);
    }
</style>
