---
import { getEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { Icon } from '../../components/icon/Icon';
import GalleryExampleRunner from '../../features/gallery/components/GalleryExampleRunner.astro';
import { getGalleryPages } from '../../features/gallery/utils/pageData';
import { GalleryExampleLink } from '../../features/gallery/components/GalleryExampleLink';

export async function getStaticPaths() {
    const galleryEntry = await getEntry('gallery', 'data');

    const pages = getGalleryPages({ galleryData: galleryEntry.data });
    return pages;
}

const { page, prevExample, nextExampleOne, nextExampleTwo } = Astro.props;
---

<Layout>
    <div class="page-margin font-size-responsive font-size-medium">
        <h1>
            <span>
                {page.title}
                {
                    page.enterprise && (
                        <span class="enterpriseIcon">
                            <Icon client:only name="enterprise" />
                        </span>
                    )
                }
            </span>

            <a class="font-size-medium" href={page.docsUrl}>
                View {page.chartTypeTitle.toLowerCase()} charts documentation
                <span class="arrow-icon">
                    <Icon client:only name="arrowRight" />
                </span>
            </a>
        </h1>

        <GalleryExampleRunner title={page.name} name={page.slug} />

        <p class="description" set:html={page.description} />

        <p class="moreExampleLabel text-secondary">More from the charts gallery...</p>

        <div class="moreExamples">
            <GalleryExampleLink
                client:load
                className="galleryExample"
                label={prevExample.title}
                exampleName={prevExample.name}
            />

            <GalleryExampleLink
                client:load
                className="galleryExample"
                label={nextExampleOne.title}
                exampleName={nextExampleOne.name}
            />

            <GalleryExampleLink
                client:load
                className="galleryExample nextExampleTwo"
                label={nextExampleTwo.title}
                exampleName={nextExampleTwo.name}
            />
        </div>
    </div>
</Layout>

<style lang="scss">
    @use '../../design-system' as *;

    .page-margin {
        padding-top: $size-5;
        padding-bottom: $size-9;
    }

    h1 {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-end;
        margin-bottom: $size-1;
    }

    h1 a {
        --font-weight: var(--font-weight-normal);

        position: relative;
        width: 100%;
        font-weight: var(--font-weight-normal);

        &:hover .arrow-icon {
            --text-color: var(--link-hover-color);

            transform: translateX(2px);
        }

        @media screen and (min-width: $breakpoint-gallery-small) {
            width: auto;
            top: -5px;
            margin-left: $size-2;
        }
    }

    .arrow-icon {
        --text-color: var(--link-color);
        --icon-size: 1.125em;

        position: relative;
        display: inline-block;
        top: -1px;
        left: -2px;
        transition: transform $default-transition-timing;
    }

    .enterpriseIcon {
        --text-color: red;
        --icon-size: 28px;
    }

    .description {
        margin-bottom: $size-8 !important;
    }

    .description,
    .moreExampleLabel {
        @media screen and (min-width: $breakpoint-gallery-small) {
            font-size: var(--font-size-large);
        }
    }

    .moreExamples {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: $size-3;
    }

    .galleryExample {
        --columns: 1;

        width: calc(100% / var(--columns) - #{$size-3} / var(--columns) * (var(--columns) - 1));

        @media screen and (min-width: 720px) {
            --columns: 2;
        }

        @media screen and (min-width: 1120px) {
            --columns: 3;
        }
    }

    .nextExampleTwo {
        display: none !important;

        @media screen and (min-width: 1120px) {
            display: block !important;
        }
    }
</style>

<style lang="scss" is:global>
    @use '../../design-system' as *;

    @media screen and (max-width: 920px) {
        .container > * > div {
            min-height: calc(480px + 48px) !important;
        }

        .tabs-content {
            height: 480px !important;
        }
    }

    .icon {
        transition: fill $default-transition-timing;
    }
</style>
