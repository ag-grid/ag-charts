---
import { getCollection, getEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { PagesNavigation } from '@components/pages-navigation/PagesNavigation';
import { Header } from '@features/docs/components/Header';
import { getFrameworkDisplayText } from '@utils/framework';
import type { Framework } from '@ag-grid-types';
import { getDocsPages } from '@features/docs/utils/pageData';
import { SideNavigation } from '@components/pages-navigation/SideNavigation';
import { addTabsToHeadings } from '@utils/addTabsToHeadings';
import { DOCS_TAB_ITEM_ID_PREFIX } from '@constants';

export async function getStaticPaths() {
    const pages = await getCollection('docs');
    return getDocsPages(pages);
}

const { page } = Astro.props;
const framework = Astro.params.framework as Framework;
const pageName = Astro.params.pageName as Framework;
const { title, enterprise, hideSideMenu, hidePageMenu } = page.data;

const { Content, headings } = await page.render();
const extendedHeadings = addTabsToHeadings({
    markdocContent: page.body,
    headings,
    getTabItemSlug: ({ id }) => `${DOCS_TAB_ITEM_ID_PREFIX}${id}`,
});

const menuEntry = await getEntry('menu', 'data');
---

<Layout title={`${getFrameworkDisplayText(framework)} Charts: AG Charts`} showTopBar={true}>
    {
        !hidePageMenu && (
            <PagesNavigation
                client:load
                slot="aside"
                menuData={menuEntry.data}
                framework={framework}
                pageName={pageName}
            />
        )
    }

    <div
        id="doc-page-wrapper"
        class:list={[
            'docPageWrapper',
            {
                hidePageMenu,
            },
        ]}
    >
        <div
            id="doc-content"
            class:list={[
                'docPage',
                {
                    noSideMenu: hideSideMenu,
                },
            ]}
        >
            <Header title={title} framework={framework} isEnterprise={enterprise} />

            {/* Wrapping div is a hack to target "intro" section of docs page */}
            <div class="pageSections">
                <Content framework={framework} page={page} />
            </div>
        </div>

        {!hideSideMenu && <SideNavigation client:load title={title} pageHeadings={extendedHeadings} />}
    </div>
</Layout>

<style lang="scss">
    @import '../../styles/docs.module.scss';
</style>
