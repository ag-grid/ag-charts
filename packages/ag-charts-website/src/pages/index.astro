---
import { getEntry } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import { FrameworkSelector } from '../components/framework-selector/FrameworkSelector';
import { Icon } from '@components/icon/Icon';
import type { GalleryData } from '@ag-grid-types';
import Code from '@components/Code';
import HomepageExampleRunner from '@features/homepage/components/HomepageExampleRunner.astro';
import { HomepageSeriesSelector } from '@features/homepage/components/HomepageSeriesSelector';
import { pathJoin } from '@utils/pathJoin';
import { SITE_BASE_URL } from '@constants';
import { getCacheBustingUrl, getChartEnterpriseScriptPath, getChartScriptPath } from '@utils/chartLibraryPaths';
import { urlWithPrefix } from '@utils/urlWithPrefix';
import styles from './homepage.module.scss';
import { ReactComponent as GridLogoType } from '@images/inline-svgs/ag-grid-logotype.svg';
import { ReactComponent as GridLogoMark } from '@images/inline-svgs/ag-grid-logomark.svg';

const frameworksData = [
    {
        name: 'javascript',
        url: urlWithPrefix({
            framework: 'javascript',
            url: './',
        }),
    },
    {
        name: 'react',
        url: urlWithPrefix({
            framework: 'react',
            url: './',
        }),
    },
    {
        name: 'angular',
        url: urlWithPrefix({
            framework: 'angular',
            url: './',
        }),
    },
    {
        name: 'vue',
        url: urlWithPrefix({
            framework: 'vue',
            url: './',
        }),
    },
];

const devExCode = `const options = {
  container: document.getElementById('chart'),
  data: [
    { label: 'Android', value: 56.9 },
    { label: 'iOS', value: 22.5 },
    { label: 'BlackBerry', value: 6.8 },
    { label: 'Symbian', value: 8.5 },
    { label: 'Windows', value: 2.6 },
  ],
  series: [
    {
      type: 'pie',
      angleKey: 'value',
      calloutLabelKey: 'label',
      sectorLabelKey: 'value',
    },
  ],
};

agCharts.AgChart.create(options);`;

const galleryDataEntry = await getEntry('gallery', 'data');
const galleryData: GalleryData = galleryDataEntry?.data;
const defaultExampleName = galleryData.homepage[0].seriesExampleName;

const heroInternalFramework = 'vanilla';
const heroDocsPageName = 'homepage';
const heroDocsExampleName = 'hero-chart';

const modifiedTimeMs = Date.now();
const siteUrl = Astro.site ? pathJoin(Astro.site, SITE_BASE_URL) : '/';
const chartScriptPath = getCacheBustingUrl(getChartScriptPath(siteUrl), modifiedTimeMs);
const chartScriptEnterprisePath = getCacheBustingUrl(getChartEnterpriseScriptPath(siteUrl), modifiedTimeMs);

const isEnterprise = true;
---

<Layout>
    <script src={chartScriptPath}></script>
    {isEnterprise && <script src={chartScriptEnterprisePath} />}

    <div class={styles.homepageHero}>
        <div class:list={[styles.heroInner, 'page-margin']}>
            <div class={styles.heroHeadings}>
                <h1 class="font-size-extra-large">The Best JavaScript Charts in the World</h1>
                <h2 class="font-size-medium normal-weight-text">
                    The professional choice for developers building enterprise applications
                </h2>
            </div>
            <div class={styles.heroChart}>
                <HomepageExampleRunner
                    internalFramework={heroInternalFramework}
                    pageName={heroDocsPageName}
                    exampleName={heroDocsExampleName}
                />
            </div>
        </div>
    </div>

    <div class={styles.homepageFrameworks}>
        <div class:list={[styles.frameworksInner, 'page-margin']}>
            <span class:list={[styles.frameworksLabel, 'text-secondary']}>Get&nbsp;started</span>
            <FrameworkSelector data={frameworksData} isFullWidth />
        </div>
    </div>

    <div class={styles.homepageSeries}>
        <div class:list={[styles.seriesInner, 'page-margin']}>
            <h2 class="font-size-gargantuan text-secondary">More series than you can shake a stick at...</h2>
            <HomepageSeriesSelector client:load defaultExampleName={defaultExampleName} galleryData={galleryData} />
        </div>
    </div>

    <div class={styles.homepageBenefits}>
        <div class:list={[styles.benefitsInner, 'page-margin']}>
            <!-- ChatGPT content to be replaced -->
            <ul class="list-style-none">
                <li>
                    <Icon name="docs-rendering" />
                    <h3>Versatile and Customizable</h3>
                    <p>
                        AG-Charts offers a wide range of chart types and extensive customization options, allowing
                        developers to create visually appealing and tailored data visualizations that seamlessly match
                        their application's design and needs.
                    </p>
                </li>
                <li>
                    <Icon name="docs-sparklines" />
                    <h3>High Performance</h3>
                    <p>
                        AG-Charts is optimized for efficiency, ensuring smooth rendering and interaction with large
                        datasets, making it suitable for real-time updates and handling big data without sacrificing
                        performance.
                    </p>
                </li>
                <li>
                    <Icon name="docs-api" />
                    <h3>Easy Integration</h3>
                    <p>
                        Compatible with popular web development frameworks and various data formats, AG-Charts
                        seamlessly integrates into existing applications, offering flexibility in data sources and
                        simplifying chart implementation.
                    </p>
                </li>
            </ul>
        </div>
    </div>

    <div class={styles.homepageDevEx}>
        <div class:list={[styles.devExInner, 'page-margin']}>
            {/* [TODO] add linenumbers */}
            <div class={styles.devExExample}>
                <div class={styles.tmpImgOuter}>
                    <img src="images/TMP-homepage-pie-tmp-image.png" alt="TEMP IMAGE" />
                </div>

                <Code code={devExCode} />
            </div>
            <div class={styles.devExCopy}>
                <h3 class="font-size-massive">
                    Your first chart in 20 lines...<br />The next 200 charts just as easy.
                </h3>
                <p class="font-size-large">
                    Get started quickly with our simple guide, then customise every aspect of our charts with our
                    <a href="./options/">robust API</a>.
                </p>
                <p class="font-size-large">
                    Learn at speed with our comprehensive <a href="./documentation">documentation</a>, packed with
                    examples, refrences, and sandboxes.
                </p>
            </div>
        </div>
    </div>

    <div class={styles.homepageGrid}>
        <div class:list={[styles.gridInner, 'page-margin']}>
            <div class={styles.gridCopy}>
                <div class={styles.agGridLogo}>
                    <GridLogoType />
                    <GridLogoMark />
                </div>
                <!-- Dummy copy, to be reviewed -->
                <p class="font-size-large">
                    <b>AG Charts</b> was created by the amazing team behind <a href="ag-grid.com"><b>AG Grid</b></a>,
                    the best javascript grid in the world.
                </p>
                <p class="font-size-large">
                    Designed to work seamlessly with <b>AG Grid</b>, <b>AG Charts</b> can make your data heavy
                    applications even more beautiful and insightful. Use <b>AG Grid</b> & <b>AG Charts</b> enterprise
                    together to get access to best
                    <a href="https://ag-grid.com/javascript-data-grid/integrated-charts/">intergrated charting</a>
                     available bar none.
                </p>
            </div>
            <div class={styles.gridExample}>
                <video src="videos/integrated-charts.mp4" muted autoplay loop></video>
            </div>
        </div>
    </div>
</Layout>
