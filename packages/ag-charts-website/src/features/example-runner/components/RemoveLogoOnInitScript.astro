---
import { getLoadingLogoId, getLoadingIFrameId } from '@features/example-runner/utils/getLoadingLogoId';
interface Props {
    pageName: string;
    exampleName: string;
}

const { pageName, exampleName } = Astro.props as Props;
const loadingLogoId = getLoadingLogoId({ pageName, exampleName });
const loadingIFrameId = getLoadingIFrameId({ pageName, exampleName });
---

<script
    define:vars={{
        pageName,
        exampleName,
        loadingLogoId,
        loadingIFrameId,
    }}
>
    window.addEventListener('message', ({ data }) => {
        const isExample = pageName === data?.pageName && exampleName === data?.exampleName;
        if (!isExample) return;

        if (data?.type === 'init') {
            document.getElementById(loadingLogoId)?.remove();
            const iframe = document.getElementById(loadingIFrameId);
            if (!iframe) return;

            iframe.style.visibility = 'visible';
            if (document.documentElement.dataset['darkMode'] === 'true') {
                iframe.contentDocument.documentElement.dataset.darkMode = true;
            }
        }
    });
</script>
